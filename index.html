<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="static/js/jquery-3.1.0.js"></script>
    <script>
      $( document ).ready(function() {
        var acc = {
          x: 0,
          y: 0,
          z: 0
        }

        var acc_gravity = {
          x: 0,
          y: 0,
          z: 0
        }

        function deadband(old_val, new_val) {
          var db = 2;
          if(Math.abs(old_val-new_val) > db) {
            old_val = new_val;
          }
          return old_val;
        }

        function deviceMotionHandler(eventData) {
          var info, xyz = "[X, Y, Z]";

          // Grab the acceleration from the results
          var acceleration = eventData.acceleration;
          info = xyz.replace("X", deadband(acc.x, acceleration.x));
          info = info.replace("Y", deadband(acc.y, acceleration.y));
          info = info.replace("Z", deadband(acc.z, acceleration.z));
          $("#acceleration").text(info);

          // Grab the acceleration including gravity from the results
          acceleration = eventData.accelerationIncludingGravity;
          info = xyz.replace("X", deadband(acc_gravity.x, acceleration.x));
          info = info.replace("Y", deadband(acc_gravity.y, acceleration.y));
          info = info.replace("Z", deadband(acc_gravity.z, acceleration.z));
          $("#accelerationIncludingGravity").text(info);

          // Grab the rotation rate from the results
          var rotation = eventData.rotationRate;
          info = xyz.replace("X", rotation.alpha);
          info = info.replace("Y", rotation.beta);
          info = info.replace("Z", rotation.gamma);
          $("#rotationRate").text(info);

          // // Grab the refresh interval from the results
          info = eventData.interval;
          $("#interval").text(info);       
        }

        if (window.DeviceMotionEvent) {
          $('#motion_info').text('Device motion supported');
          window.addEventListener('devicemotion', deviceMotionHandler, false);
        } else {
          $('#motion_info').text('Device motion not supported');
        }
      });
    </script>
    <title>Motion</title>
  </head>

  <body>
    <div id="motion_info"></div>
    <div id="acceleration"></div>
    <div id="accelerationIncludingGravity"></div>
    <div id="rotationRate"></div>
    <div id="interval"></div>
  </body>
</html>
